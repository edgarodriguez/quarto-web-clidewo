---
title: "Cars and Fuel Efficiency: A Data Story"
format: 
  closeread-html:
    theme: dark
    css: |
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
      
      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: #e2e8f0;
      }
      
      .cr-section {
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(148, 163, 184, 0.1);
        border-radius: 16px;
        padding: 2rem;
        margin: 2rem 0;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }
      
      .cr-section:hover {
        transform: translateY(-5px);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        border-color: rgba(148, 163, 184, 0.3);
      }
      
      h1, h2 {
        background: linear-gradient(135deg, #60a5fa 0%, #a855f7 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
        animation: slideInFromTop 1s ease-out;
      }
      
      h1 { font-size: 3rem; }
      h2 { font-size: 2rem; }
      
      p {
        font-size: 1.1rem;
        line-height: 1.7;
        opacity: 0;
        animation: fadeInUp 1s ease-out 0.5s forwards;
      }
      
      @keyframes slideInFromTop {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .plot-container {
        background: rgba(30, 41, 59, 0.5);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }
      
      .plot-container:hover {
        background: rgba(30, 41, 59, 0.7);
        transform: scale(1.02);
      }
---

```{r}
#| label: setup
#| include: false
#| message: false
#| warning: false

# Set CRAN mirror first
options(repos = c(CRAN = "https://cloud.r-project.org/"))

# Install and load packages with error handling
packages <- c("ggplot2", "dplyr", "plotly")

for (pkg in packages) {
  if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
    install.packages(pkg, quiet = TRUE)
    library(pkg, character.only = TRUE)
  }
}

# Try to load gganimate (optional)
if (!require(gganimate, quietly = TRUE)) {
  message("gganimate not available - animations will be skipped")
}

# Load closeread if available
if (requireNamespace("closeread", quietly = TRUE)) {
  library(closeread)
}

# Custom theme with animations and modern styling
theme_cyber <- function() {
  theme_minimal(base_size = 14) +
  theme(
    plot.background = element_rect(fill = "transparent", color = NA),
    panel.background = element_rect(fill = "transparent", color = NA),
    panel.grid.major = element_line(color = alpha("#64748b", 0.3), size = 0.5),
    panel.grid.minor = element_line(color = alpha("#64748b", 0.1), size = 0.25),
    plot.title = element_text(
      color = "#f8fafc", 
      size = 20, 
      face = "bold",
      margin = margin(b = 20)
    ),
    axis.title = element_text(color = "#cbd5e1", size = 14, face = "bold"),
    axis.text = element_text(color = "#94a3b8", size = 12),
    legend.background = element_rect(
      fill = alpha("#1e293b", 0.9), 
      color = alpha("#64748b", 0.3),
      size = 0.5
    ),
    legend.title = element_text(color = "#f1f5f9", face = "bold"),
    legend.text = element_text(color = "#cbd5e1"),
    legend.position = "bottom",
    legend.box.background = element_rect(color = "transparent")
  )
}

theme_set(theme_cyber())
```

::: {.cr-section}

# 🚗 The Mystery of Fuel Efficiency

In 1974, *Motor Trend* magazine compiled data on 32 automobiles, unknowingly creating a dataset that would become legendary in data science. Hidden within these numbers lies a story about the relationship between car weight and fuel efficiency—a tale that reveals the fundamental engineering trade-offs that shaped the automotive industry.

**Scroll down to uncover the data story, where each visualization will transform before your eyes...**

```{r}
#| label: base-plot
#| cr-id: cars-viz
#| fig-width: 10
#| fig-height: 7

# Create base plot with enhanced styling
p1 <- ggplot(mtcars, aes(x = mpg, y = wt)) + 
  geom_point(
    size = 5, 
    alpha = 0.8, 
    color = "#60a5fa",
    stroke = 1.5,
    fill = alpha("#60a5fa", 0.6)
  ) +
  labs(
    x = "🏁 Miles per Gallon", 
    y = "⚖️ Weight (1000 lbs)",
    title = "32 Cars from Motor Trend Magazine (1974)"
  ) +
  xlim(8, 37) +
  ylim(0.8, 6.2) +
  # Add subtle glow effect
  geom_point(
    size = 8, 
    alpha = 0.1, 
    color = "#60a5fa"
  )

# Convert to plotly for interactivity
ggplotly(p1, tooltip = c("x", "y")) %>%
  config(displayModeBar = FALSE) %>%
  layout(
    font = list(family = "Inter", color = "#e2e8f0"),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

:::

::: {.cr-section}

## 📉 A Clear Pattern Emerges

The relationship jumps out immediately: **heavier cars get dramatically worse gas mileage**. This isn't just correlation—it's physics in action. More mass requires more energy to accelerate, more energy to overcome rolling resistance, more energy to climb hills.

*But what if this simple story is hiding something more complex?*

```{r}
#| label: trend-plot
#| cr-id: cars-viz
#| fig-width: 10
#| fig-height: 7

# Enhanced plot with animated trend line
p2 <- ggplot(mtcars, aes(x = mpg, y = wt)) + 
  geom_point(
    size = 5, 
    alpha = 0.8, 
    color = "#60a5fa",
    stroke = 1.5
  ) +
  geom_smooth(
    method = "lm", 
    se = TRUE, 
    color = "#ef4444", 
    fill = alpha("#ef4444", 0.2),
    size = 2,
    linetype = "solid"
  ) +
  labs(
    x = "🏁 Miles per Gallon", 
    y = "⚖️ Weight (1000 lbs)",
    title = "🔥 Heavier Cars Burn More Fuel"
  ) +
  xlim(8, 37) +
  ylim(0.8, 6.2) +
  # Glow effects
  geom_point(size = 8, alpha = 0.1, color = "#60a5fa") +
  geom_smooth(
    method = "lm", 
    se = FALSE, 
    color = alpha("#ef4444", 0.3), 
    size = 6
  )

ggplotly(p2, tooltip = c("x", "y")) %>%
  config(displayModeBar = FALSE) %>%
  layout(
    font = list(family = "Inter", color = "#e2e8f0"),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

:::

::: {.cr-section}

## 🎨 The Engine Size Revelation

Watch as the data transforms! When we paint each car by its engine size, the single story fractures into **three distinct narratives**. Cars aren't just heavy or light—they represent completely different engineering philosophies.

*Hover over the points to see individual car details...*

```{r}
#| label: colored-plot
#| cr-id: cars-viz  
#| fig-width: 10
#| fig-height: 7

# Add car names for better tooltips
mtcars_enhanced <- mtcars %>%
  mutate(
    car_name = rownames(mtcars),
    cyl_group = case_when(
      cyl == 4 ~ "4-Cylinder Economy",
      cyl == 6 ~ "6-Cylinder Balanced", 
      cyl == 8 ~ "8-Cylinder Power"
    )
  )

p3 <- ggplot(mtcars_enhanced, aes(x = mpg, y = wt, color = factor(cyl), text = paste("Car:", car_name))) + 
  geom_point(
    size = 6, 
    alpha = 0.9,
    stroke = 2
  ) +
  scale_color_manual(
    values = c(
      "4" = "#10b981",  # Emerald green
      "6" = "#f59e0b",  # Amber orange  
      "8" = "#ef4444"   # Red
    ),
    name = "🔧 Engine Type",
    labels = c("4-Cyl Economy", "6-Cyl Balanced", "8-Cyl Power")
  ) +
  labs(
    x = "🏁 Miles per Gallon", 
    y = "⚖️ Weight (1000 lbs)",
    title = "🌈 Three Engineering Philosophies Revealed"
  ) +
  xlim(8, 37) +
  ylim(0.8, 6.2) +
  # Glow effects for each color
  geom_point(aes(color = factor(cyl)), size = 10, alpha = 0.15) +
  guides(
    color = guide_legend(
      override.aes = list(size = 4, alpha = 1),
      title.position = "top"
    )
  )

ggplotly(p3, tooltip = "text") %>%
  config(displayModeBar = FALSE) %>%
  layout(
    font = list(family = "Inter", color = "#e2e8f0"),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)",
    legend = list(
      bgcolor = "rgba(30, 41, 59, 0.9)",
      bordercolor = "rgba(100, 116, 139, 0.3)",
      borderwidth = 1
    )
  )
```

:::

::: {.cr-section}

## 📊 Three Perfect Stories

The final revelation: each engine type follows its **own efficiency frontier**. These aren't random clusters—they're three parallel universes of automotive engineering, each optimized for different priorities.

*Watch the trend lines paint the complete picture...*

```{r}
#| label: final-plot
#| cr-id: cars-viz
#| fig-width: 10
#| fig-height: 7

p4 <- ggplot(mtcars_enhanced, aes(x = mpg, y = wt, color = factor(cyl), text = paste("Car:", car_name))) + 
  geom_point(
    size = 6, 
    alpha = 0.9,
    stroke = 2
  ) +
  geom_smooth(
    method = "lm", 
    se = TRUE, 
    size = 2.5,
    alpha = 0.3
  ) +
  scale_color_manual(
    values = c(
      "4" = "#10b981",
      "6" = "#f59e0b", 
      "8" = "#ef4444"
    ),
    name = "🔧 Engine Type",
    labels = c("4-Cyl Economy", "6-Cyl Balanced", "8-Cyl Power")
  ) +
  scale_fill_manual(
    values = c(
      "4" = alpha("#10b981", 0.2),
      "6" = alpha("#f59e0b", 0.2),
      "8" = alpha("#ef4444", 0.2)
    ),
    guide = "none"
  ) +
  labs(
    x = "🏁 Miles per Gallon", 
    y = "⚖️ Weight (1000 lbs)",
    title = "✨ Each Engine Type Follows Its Own Efficiency Law"
  ) +
  xlim(8, 37) +
  ylim(0.8, 6.2) +
  # Multi-layer glow effects
  geom_point(aes(color = factor(cyl)), size = 10, alpha = 0.1) +
  geom_point(aes(color = factor(cyl)), size = 15, alpha = 0.05) +
  guides(
    color = guide_legend(
      override.aes = list(size = 4, alpha = 1),
      title.position = "top"
    )
  )

ggplotly(p4, tooltip = "text") %>%
  config(displayModeBar = FALSE) %>%
  layout(
    font = list(family = "Inter", color = "#e2e8f0"),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)",
    legend = list(
      bgcolor = "rgba(30, 41, 59, 0.9)",
      bordercolor = "rgba(100, 116, 139, 0.3)",
      borderwidth = 1
    )
  )
```

:::

::: {.cr-section}

## 🚀 The Engineering Truth

This simple dataset reveals a **fundamental law of automotive design**: engineering is the art of intelligent trade-offs. 

In 1974, manufacturers had already discovered market segmentation through engineering:

- 🟢 **4-Cylinder Economy Cars**: Maximized fuel efficiency for budget-conscious buyers
- 🟡 **6-Cylinder Family Cars**: Balanced power and efficiency for mainstream families  
- 🔴 **8-Cylinder Performance Cars**: Prioritized power and prestige over fuel costs

What appeared to be a simple relationship between weight and fuel economy was actually **three parallel engineering philosophies** competing in the same marketplace—each serving different human needs and desires.

**The data doesn't just show cars. It shows us.**

---

*💡 **Technical Note**: This analysis uses the famous `mtcars` dataset from Henderson and Velleman (1981). Interactive visualizations powered by plotly, with custom CSS animations and closeread scrollytelling framework.*

*🎨 **Design**: Cyberpunk-inspired dark theme with neon accents, glassmorphism effects, and smooth animations to enhance the data storytelling experience.*

:::